<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Men√º ve Fiyat Listesi Olu≈üturucu</title>

    <!-- Gerekli K√ºt√ºphaneler -->
    <script src="js/jspdf.umd.min.js"></script>
    <script src="js/html2canvas.min.js"></script>
    <link href="css/libre-baskerville.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Libre Baskerville', serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            background: #fff;
            padding: 20px 30px;
            border-radius: 10px;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 10px;
        }

        label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"] {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .category {
            margin-bottom: 15px;
        }

        .menu-item {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }

        .menu-item input {
            flex: 1;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #0056b3;
        }

        .btn-group {
            text-align: center;
            margin-top: 20px;
        }

        #previewArea {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Men√º ve Fiyat Listesi Olu≈üturucu</h1>

        <label for="tarih">Tarih</label>
        <input type="date" id="tarih">

        <label for="gun">G√ºn√ºn Adƒ± (√∂rn. SALI)</label>
        <input type="text" id="gun" placeholder="G√úN√ú Gƒ∞Rƒ∞Nƒ∞Z">

        <div class="category" id="corbalar">
            <h3>√áorbalar</h3>
            <div id="corbaList"></div>
            <button onclick="addItem('corbaList')">+ √áorba Ekle</button>
        </div>

        <div class="category" id="anayemekler">
            <h3>Ana Yemekler</h3>
            <div id="anaList"></div>
            <button onclick="addItem('anaList')">+ Ana Yemek Ekle</button>
        </div>

        <div class="category" id="arasicaklar">
            <h3>Ara Sƒ±caklar</h3>
            <div id="araList"></div>
            <button onclick="addItem('araList')">+ Ara Sƒ±cak Ekle</button>
        </div>

        <div class="category" id="mezeSalata">
            <h3>Meze / Salatalar</h3>
            <div id="mezeList"></div>
            <button onclick="addItem('mezeList')">+ Meze / Salata Ekle</button>
        </div>

        <div class="btn-group">
            <button onclick="showPreview()">üìã √ñnizleme</button>
            <button onclick="generatePDF()">üìÑ PDF Yazdƒ±r</button>
            <button onclick="generateODF()">üìù ODF Kaydet</button>
        </div>

        <div id="previewArea"></div>
    </div>

    <script>
        // === Yardƒ±mcƒ± fonksiyonlar ===
        function addItem(listId) {
            const container = document.getElementById(listId);
            const div = document.createElement('div');
            div.className = 'menu-item';
            div.innerHTML = `
        <input type="text" placeholder="Yemek adƒ±">
        <input type="number" placeholder="Fiyat (TL)">
      `;
            container.appendChild(div);
        }

        function getItems(listId) {
            const items = [];
            document.querySelectorAll(`#${listId} .menu-item`).forEach(el => {
                const name = el.children[0].value.trim().toUpperCase();
                const price = el.children[1].value.trim();
                if (name && price) items.push({ name, price });
            });
            return items;
        }
        async function getLogoBase64(url) {
            const response = await fetch(url);
            const blob = await response.blob();
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(blob);
            });
        }


        function buildHTML() {
            const tarih = document.getElementById('tarih').value;
            const gun = document.getElementById('gun').value.trim().toUpperCase();
            const date = tarih ? new Date(tarih) : new Date();
            const dateStr = date.toLocaleDateString('tr-TR');

            const corbalar = getItems('corbaList');
            const anayemekler = getItems('anaList');
            const arasicaklar = getItems('araList');
            const meze = getItems('mezeList');

            // A4 pt √∂l√ß√ºleri: width ‚âà 595.28pt, height ‚âà 841.89pt
            // Biz stil i√ßinde px kullanacaƒüƒ±z; generatePDF() bu geni≈üliƒüi pdf ile e≈üitleyecek.
            let html = `
    <div class="pdf-page" style="font-family: Calibri, sans-serif; font-size:24px; box-sizing:border-box; position:relative; width:100%; height:100%;">
      <!-- HEADER: logo tam geni≈ülik, ba≈ülƒ±k ortada -->
      <div class="pdf-header" style="text-align:center; width:100%; box-sizing:border-box;">
        <img src="logo.png" alt="Logo" style="width:100%; height:auto; display:block;">
        <h2 style="margin-top:28px; margin-bottom:0; font-size:20px; font-weight:bold;">
  ${dateStr} ${gun} MEN√ú VE Fƒ∞YAT Lƒ∞STESƒ∞
</h2>
      </div>

      <!-- MENU: sadece bu alanƒ±n soldan 2.5cm (72px) padding'i olacak -->
      <div class="pdf-menu" style="box-sizing:border-box; padding-left:72px; padding-right:36px; margin-top:12px; overflow:auto;">
  `;

            function section(title, items) {
                if (!items.length) return '';
                let text = `<div style="margin-bottom:8px;"><b style="font-size:16px;">${title.toUpperCase()}</b><br>`;
                items.forEach(i => {
                    text += `<div style="margin-top:6px; font-size:16px;">${i.name} <b>${i.price} TL</b></div>`;
                });
                text += `</div>`;
                return text;
            }

            html += section('√áorbalar', corbalar);
            html += section('Ana Yemekler', anayemekler);
            html += section('Ara Sƒ±caklar', arasicaklar);
            html += section('Meze / Salatalar', meze);

            html += `
      </div>

      <!-- BOTTOM: A4 altƒ±ndan 2.5 cm yukarƒ±da olacak -->
      <div class="pdf-bottom" style="position:absolute; left:0; right:0; text-align:center; bottom:72px; box-sizing:border-box;">
        <div style="font-size:16px;">
          √ñƒûLEN YEMEKLERƒ∞NDE <u style="text-decoration-thickness:2px;"><b>√áAY √úCRETSƒ∞ZDƒ∞R</b></u>
        </div>
      </div>
    </div>
  `;

            return html;
        }





        function showPreview() {
            const html = buildHTML();
            const preview = document.getElementById("previewArea");
            preview.style.display = "block";
            preview.innerHTML = html;
        }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF("p", "pt", "a4"); // birim: point
            const pdfWidth = Math.round(pdf.internal.pageSize.getWidth()); // ~595
            const pdfHeight = Math.round(pdf.internal.pageSize.getHeight()); // ~842

            // Olu≈üturulacak HTML elementini hazƒ±rlƒ±yoruz
            const element = document.createElement('div');
            element.style.width = pdfWidth + 'px';
            element.style.height = pdfHeight + 'px';
            element.style.boxSizing = 'border-box';
            element.style.background = '#ffffff';
            element.innerHTML = buildHTML();

            // DOM'a ekleyelim (ge√ßici)
            element.style.position = 'fixed';
            element.style.left = '-9999px';
            document.body.appendChild(element);

            // HEADER y√ºksekliƒüini √∂l√ß√ºp menu i√ßin max-height ayarlayalƒ±m
            const header = element.querySelector('.pdf-header');
            const menu = element.querySelector('.pdf-menu');
            const bottomSpace = 72; // 2.5 cm (pt ~ px kar≈üƒ±lƒ±ƒüƒ±yla kullanƒ±yoruz)
            const headerH = header ? header.getBoundingClientRect().height : 0;
            // Men√º i√ßin kullanƒ±labilir alan = toplam y√ºkseklik - header - bottomSpace - k√º√ß√ºk buffer
            const buffer = 20;
            const menuMax = Math.max(0, pdfHeight - headerH - bottomSpace - buffer);
            if (menu) {
                menu.style.maxHeight = menuMax + 'px';
                menu.style.overflow = 'hidden'; // ta≈ümayƒ± engelle (ihtiya√ß varsa scroll yerine kesme)
            }

            // html2canvas ile y√ºksek √ß√∂z√ºn√ºrl√ºkte yakala
            const scale = 1.4; // y√ºksek kalite; eƒüer √ßok b√ºy√ºk dosya olursa 2'ye √ßek
            const canvas = await html2canvas(element, { scale: scale, useCORS: true });
            const imgData = canvas.toDataURL('image/png');

            // G√∂r√ºnt√ºy√º PDF'e sƒ±ƒüdƒ±r
            const imgProps = pdf.getImageProperties(imgData);
            const pdfImgWidth = pdfWidth;
            const pdfImgHeight = (imgProps.height * pdfImgWidth) / imgProps.width;
            pdf.addImage(imgData, 'PNG', 0, 0, pdfImgWidth, pdfImgHeight);

            // === Burayƒ± deƒüi≈ütiriyoruz: dosya adƒ± se√ßilen tarih ile ===
            const tarih = document.getElementById('tarih').value; // YYYY-MM-DD formatƒ±nda
            let formattedDate = tarih ? tarih.replaceAll('-', '.') : 'Tarih';
            pdf.save(`${formattedDate} Kuleli Men√º ve Fiyat Listesi.pdf`);

            // Temizlik
            document.body.removeChild(element);
        }


        function generateODF() {
            const html = buildHTML();
            const blob = window.htmlDocx.asBlob(html);
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'menu_ve_fiyat.odt';
            link.click();
        }

        // Ba≈ülangƒ±√ßta √∂rnek satƒ±rlar eklensin
        addItem('corbaList');
        addItem('anaList');
        addItem('araList');
        addItem('mezeList');
    </script>
</body>

</html>